# FastAPI é¡¹ç›®æ¶æ„å›¾

## ğŸ“Š æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å®¢æˆ·ç«¯                                â”‚
â”‚                    (æµè§ˆå™¨/ç§»åŠ¨åº”ç”¨)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP è¯·æ±‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FastAPI åº”ç”¨                             â”‚
â”‚                       (main.py)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  CORS ä¸­é—´ä»¶ã€è·¯ç”±æ³¨å†Œã€å…¨å±€å¼‚å¸¸å¤„ç†                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
        â†“              â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ users æ¨¡å—   â”‚ â”‚ posts æ¨¡å—   â”‚ â”‚ ... æ¨¡å—     â”‚
â”‚ (router.py)  â”‚ â”‚ (router.py)  â”‚ â”‚ (router.py)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â”‚ è°ƒç”¨ CRUD      â”‚ è°ƒç”¨ CRUD      â”‚ è°ƒç”¨ CRUD
       â†“                â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ crud.py      â”‚ â”‚ crud.py      â”‚ â”‚ crud.py      â”‚
â”‚ (æ•°æ®åº“æ“ä½œ)  â”‚ â”‚ (æ•°æ®åº“æ“ä½œ)  â”‚ â”‚ (æ•°æ®åº“æ“ä½œ)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ ä½¿ç”¨ Session
                        â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Database    â”‚
                â”‚ (PostgreSQL) â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ å•ä¸ªæ¨¡å—çš„å†…éƒ¨ç»“æ„

```
app/users/
â”‚
â”œâ”€â”€ router.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   (API è·¯ç”±)                       â”‚
â”‚   - å®šä¹‰ API æ¥å£                  â”‚
â”‚   - å¤„ç† HTTP è¯·æ±‚/å“åº”            â”‚
â”‚   - è°ƒç”¨ crud å‡½æ•°                 â”‚
â”‚                                    â”‚
â”œâ”€â”€ schema.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   (Pydantic æ¨¡å‹)                  â”‚
â”‚   - UserCreate (è¯·æ±‚éªŒè¯)          â”‚
â”‚   - UserResponse (å“åº”åºåˆ—åŒ–)      â”‚
â”‚   - UserUpdate (æ›´æ–°éªŒè¯)          â”‚
â”‚                                    â”‚
â”œâ”€â”€ crud.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   (æ•°æ®åº“æ“ä½œ)                     â”‚
â”‚   - create_user()                 â”‚
â”‚   - get_user_by_id()              â”‚
â”‚   - update_user()                 â”‚
â”‚   - delete_user()                 â”‚
â”‚                                    â”‚
â”œâ”€â”€ model.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   (SQLModel æ•°æ®åº“æ¨¡å‹)            â”‚
â”‚   - User ç±»                        â”‚
â”‚   - å®šä¹‰è¡¨ç»“æ„                     â”‚
â”‚                                    â”‚
â”œâ”€â”€ dependencies.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   (ä¾èµ–é¡¹)                         â”‚
â”‚   - get_current_user()            â”‚
â”‚   - get_current_superuser()       â”‚
â”‚                                    â”‚
â””â”€â”€ __init__.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    (å¯¼å‡º router)
```

## ğŸŒŠ è¯·æ±‚å¤„ç†æµç¨‹

```
1. å®¢æˆ·ç«¯è¯·æ±‚
   POST /users/register
   {
     "username": "alice",
     "email": "alice@example.com",
     "password": "secret123"
   }
   â”‚
   â†“
2. main.py è·¯ç”±åŒ¹é…
   app.include_router(users_router, prefix="/users")
   æ‰¾åˆ° /users/register â†’ users/router.py
   â”‚
   â†“
3. router.py å¤„ç†è¯·æ±‚
   @router.post("/register", response_model=UserResponse)
   def register_user(user_in: UserCreate, session: Session = Depends(get_session)):
   â”‚
   â”œâ”€â†’ éªŒè¯è¯·æ±‚æ•°æ® (UserCreate schema)
   â”‚   âœ“ username: 3-50 å­—ç¬¦
   â”‚   âœ“ email: æœ‰æ•ˆé‚®ç®±æ ¼å¼
   â”‚   âœ“ password: è‡³å°‘ 6 ä¸ªå­—ç¬¦
   â”‚
   â”œâ”€â†’ ä¾èµ–æ³¨å…¥ (Depends)
   â”‚   è·å–æ•°æ®åº“ä¼šè¯ session
   â”‚
   â†“
4. crud.py æ‰§è¡Œæ•°æ®åº“æ“ä½œ
   crud.create_user(session, user_in)
   â”‚
   â”œâ”€â†’ åŠ å¯†å¯†ç 
   â”‚   hashed_password = hash_password(user_in.password)
   â”‚
   â”œâ”€â†’ åˆ›å»º User å¯¹è±¡ (model.py)
   â”‚   user = User(username=..., email=..., hashed_password=...)
   â”‚
   â”œâ”€â†’ ä¿å­˜åˆ°æ•°æ®åº“
   â”‚   session.add(user)
   â”‚   session.commit()
   â”‚   session.refresh(user)
   â”‚
   â†“
5. è¿”å›å“åº”
   ä½¿ç”¨ UserResponse schema åºåˆ—åŒ–
   {
     "id": 1,
     "username": "alice",
     "email": "alice@example.com",
     "is_active": true,
     "is_superuser": false,
     "created_at": "2025-12-02T10:00:00",
     "updated_at": "2025-12-02T10:00:00"
   }
   (æ³¨æ„ï¼šå¯†ç ä¸ä¼šè¿”å›)
```

## ğŸ” ä¾èµ–æ³¨å…¥æµç¨‹

```
@router.get("/me", response_model=UserResponse)
def get_current_user_info(
    current_user: User = Depends(get_current_active_user)
):
    return current_user

æ‰§è¡Œæµç¨‹:
1. FastAPI çœ‹åˆ° Depends(get_current_active_user)
   â†“
2. è°ƒç”¨ get_current_active_user()
   â†“
3. get_current_active_user ä¾èµ– get_current_user
   â†“
4. get_current_user ä¾èµ– oauth2_scheme å’Œ get_session
   â†“
5. è·å– token â†’ éªŒè¯ token â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ è¿”å› User å¯¹è±¡
   â†“
6. æ£€æŸ¥ user.is_active
   â†“
7. è¿”å› current_user ç»™è·¯ç”±å‡½æ•°
```

## ğŸ“¦ æ¨¡å—ä¹‹é—´çš„å…³ç³»

```
main.py
  â”‚
  â”œâ”€â†’ users/router.py
  â”‚     â”‚
  â”‚     â”œâ”€â†’ users/schema.py (UserCreate, UserResponse)
  â”‚     â”œâ”€â†’ users/crud.py (create_user, get_user_by_id)
  â”‚     â”œâ”€â†’ users/dependencies.py (get_current_user)
  â”‚     â””â”€â†’ core/database.py (get_session)
  â”‚
  â”œâ”€â†’ posts/router.py
  â”‚     â”‚
  â”‚     â”œâ”€â†’ posts/schema.py
  â”‚     â”œâ”€â†’ posts/crud.py
  â”‚     â”œâ”€â†’ posts/dependencies.py
  â”‚     â””â”€â†’ users/dependencies.py (get_current_user) â† è·¨æ¨¡å—ä¾èµ–
  â”‚
  â””â”€â†’ core/
        â”œâ”€â†’ config.py (settings)
        â”œâ”€â†’ database.py (engine, get_session)
        â””â”€â†’ base.py (BaseModel)
```

## ğŸ¯ å…³é”®æ¦‚å¿µ

### 1. åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Router å±‚     â”‚  â† API æ¥å£å®šä¹‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Schema å±‚     â”‚  â† æ•°æ®éªŒè¯/åºåˆ—åŒ–
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   CRUD å±‚       â”‚  â† ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Model å±‚      â”‚  â† æ•°æ®åº“æ¨¡å‹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Database å±‚    â”‚  â† æ•°æ®åº“è¿æ¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ä¾èµ–æ³¨å…¥

```
è·¯ç”±å‡½æ•°
  â†“ Depends
ä¾èµ–å‡½æ•° (get_session, get_current_user)
  â†“ Depends
æ›´æ·±å±‚çš„ä¾èµ– (oauth2_scheme)
```

### 3. æ¨¡å‹åˆ†ç¦»

```
SQLModel (model.py)
  â†“ ç”¨äºæ•°æ®åº“æ“ä½œ
  â†“
Pydantic (schema.py)
  â†“ ç”¨äº API è¾“å…¥è¾“å‡º
  â†“ å¯ä»¥éšè—æ•æ„Ÿå­—æ®µï¼ˆå¦‚å¯†ç ï¼‰
```
