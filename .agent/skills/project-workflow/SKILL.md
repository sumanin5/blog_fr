---
name: project-workflow
description: é¡¹ç›®å¯åŠ¨ã€ç¯å¢ƒæ­å»ºä¸æ—¥å¸¸å¼€å‘å·¥ä½œæµã€‚æ¶µç›– local ä¸ docker ä¸¤ç§æ¨¡å¼ä¸‹çš„å¯åŠ¨æŒ‡ä»¤ã€‚
---

# é¡¹ç›®å·¥ä½œæµä¸å¯åŠ¨è§„èŒƒ

## ğŸ—ï¸ åŸºç¡€åº•åº§
æœ¬é¡¹ç›®éµå¾ªä»¥ä¸‹é€šç”¨å¼€å‘æ ‡å‡†ï¼š
- **Python ç¯å¢ƒ**: éµå¾ª [python-uv-web](~/.claude/skills/python-uv-web/SKILL.md) è§„èŒƒã€‚
- **å‰ç«¯ç¯å¢ƒ**: éµå¾ª [nextjs-pnpm](~/.claude/skills/nextjs-pnpm/SKILL.md) è§„èŒƒã€‚

## ğŸš€ é¡¹ç›®ç‰¹å®šå¯åŠ¨æµç¨‹
åœ¨éµå¾ªé€šç”¨è§„èŒƒçš„åŸºç¡€ä¸Šï¼Œæœ¬é¡¹ç›®æœ‰ä»¥ä¸‹ç‰¹æœ‰é€»è¾‘ï¼š

### 1. æœ¬åœ°å¼€å‘æ¨¡å¼ (æ¨èï¼Œå“åº”æœ€å¿«)

#### åç«¯ (FastAPI)
- **ç›®å½•**: `/backend`
- **å‰æ**: å·²å®‰è£… `uv`
- **å¯åŠ¨**: `uv run fastapi dev app/main.py`
- **ç«¯å£**: `8000`
- **æ–‡æ¡£**: `http://localhost:8000/docs`

#### å‰ç«¯ (Next.js)
- **ç›®å½•**: `/frontend`
- **å‰æ**: å·²å®‰è£… `pnpm`
- **å¯åŠ¨**: `pnpm dev`
- **ç«¯å£**: `3000`
- **æ³¨æ„**: æœ¬åœ°æ¨¡å¼ä¸‹ï¼Œå‰ç«¯é€šè¿‡ `next.config.ts` ä¸­çš„ `rewrites` ä»£ç†åˆ° `127.0.0.1:8000`ã€‚

### 2. å®¹å™¨å¼€å‘æ¨¡å¼ (ç¯å¢ƒä¸€è‡´æ€§)
- **å‘½ä»¤**: `docker compose -f docker-compose.dev.yml up`
- **ç‰¹ç‚¹**:
  - æ”¯æŒçƒ­æ›´æ–° (Hot Reload)ã€‚
  - è‡ªåŠ¨å¤„ç†æ•°æ®åº“ã€Redis ç­‰åŸºç¡€è®¾æ–½ã€‚
  - å‰ç«¯é€šè¿‡ Docker ç½‘ç»œè¿æ¥åç«¯ (`http://backend:8000`)ã€‚

---

## ğŸ› ï¸ åˆå§‹åŒ–æµç¨‹ (æ–°ç¯å¢ƒ)

å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å…‹éš†é¡¹ç›®ï¼Œè¯·æŒ‰æ­¤é¡ºåºæ‰§è¡Œï¼š

1. **ç¯å¢ƒå‡†å¤‡**:
   - å¤åˆ¶ `.env.example` -> `.env` (æ ¹æ®éœ€è¦ä¿®æ”¹)ã€‚
   - ç¡®ä¿å®‰è£…äº† `uv`, `pnpm`, `docker`ã€‚

2. **åç«¯åˆå§‹åŒ–**:
   ```bash
   cd backend
   uv sync               # å®‰è£…ä¾èµ–
   make db-migrate       # åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„
   uv run app/initial_data.py  # æ³¨å…¥åˆå§‹ç®¡ç†å‘˜æ•°æ®
   ```

3. **å‰ç«¯åˆå§‹åŒ–**:
   ```bash
   cd frontend
   pnpm install          # å®‰è£…ä¾èµ–
   pnpm api:generate     # ç”Ÿæˆ API SDKï¼ˆå¼ºçƒˆå»ºè®®ï¼‰
   ```

4. **å†…å®¹åŒæ­¥**:
   ```bash
   ./scripts/sync-posts.sh  # å°† content/ ä¸‹çš„ç¤ºä¾‹å†…å®¹åŒæ­¥åˆ°æ•°æ®åº“
   ```

---

## ğŸ”„ æ—¥å¸¸å¼€å‘å¾ªç¯

1. **ä¿®æ”¹ä»£ç **:
   - åç«¯é€»è¾‘ä¿®æ”¹ã€‚
   - å‰ç«¯ UI ä¿®æ”¹ã€‚
2. **åŒæ­¥ API (å¦‚æœåç«¯ Schema å˜äº†)**:
   - æ‰§è¡Œ `./scripts/generate-api.sh`ã€‚
3. **éªŒè¯**:
   - è¿è¡Œæµ‹è¯•: `cd backend && make test`ã€‚
   - æ£€æŸ¥ lint: `make lint` (backend) / `pnpm lint` (frontend)ã€‚

---

## âš ï¸ å¸¸è§é—®é¢˜å¯åŠ¨æ£€æŸ¥é¡¹
- **æ•°æ®åº“è¿æ¥å¤±è´¥**: æ£€æŸ¥ `.env` ä¸­çš„ `DATABASE_URL` æ˜¯å¦æ­£ç¡®ï¼ˆæœ¬åœ°é€šå¸¸æ˜¯ localhostï¼ŒDocker å†…é€šå¸¸æ˜¯ dbï¼‰ã€‚
- **å‰ç«¯ SSR æŠ¥é”™**: æ£€æŸ¥ `BACKEND_INTERNAL_URL` ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æ­£ç¡®ã€‚
- **ç«¯å£å ç”¨**: ç¡®ä¿ 3000 å’Œ 8000 ç«¯å£æœªè¢«å…¶ä»–æœåŠ¡å ç”¨ã€‚
