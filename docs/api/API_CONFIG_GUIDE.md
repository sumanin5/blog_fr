# API å®¢æˆ·ç«¯é…ç½®æŒ‡å— (config.ts)

> æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜Ž `src/api/config.ts` çš„ä½œç”¨ã€ç¼–å†™æ—¶æœºã€ç¼–å†™æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹ã€‚

---

## ç›®å½•

1. [config.ts æ˜¯ä»€ä¹ˆï¼Ÿ](#1-configts-æ˜¯ä»€ä¹ˆ)
2. [åœ¨ç”Ÿæˆå‰è¿˜æ˜¯ç”ŸæˆåŽç¼–å†™ï¼Ÿ](#2-åœ¨ç”Ÿæˆå‰è¿˜æ˜¯ç”ŸæˆåŽç¼–å†™)
3. [æ–‡ä»¶ç»„ç»‡ç»“æž„](#3-æ–‡ä»¶ç»„ç»‡ç»“æž„)
4. [å¦‚ä½•ç¼–å†™ config.ts](#4-å¦‚ä½•ç¼–å†™-configts)
5. [é…ç½®é¡¹è¯¦è§£](#5-é…ç½®é¡¹è¯¦è§£)
6. [æ³¨æ„äº‹é¡¹](#6-æ³¨æ„äº‹é¡¹)
7. [å¸¸è§é—®é¢˜](#7-å¸¸è§é—®é¢˜)

---

## 1. config.ts æ˜¯ä»€ä¹ˆï¼Ÿ

### ä¸€å¥è¯è§£é‡Š

**`config.ts` æ˜¯ä½ æ‰‹åŠ¨åˆ›å»ºçš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºŽå‘Šè¯‰è‡ªåŠ¨ç”Ÿæˆçš„ API å®¢æˆ·ç«¯ï¼š"åŽç«¯åœ¨å“ªé‡Œ"ã€"å¦‚ä½•è®¤è¯"ã€"å‡ºé”™äº†æ€Žä¹ˆåŠž"ã€‚**

### è§’è‰²å®šä½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API å±‚æ–‡ä»¶ç»“æž„                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

src/api/
â”œâ”€â”€ ðŸ¤– index.ts          â† è‡ªåŠ¨ç”Ÿæˆï¼ˆç»Ÿä¸€å¯¼å‡ºï¼‰
â”œâ”€â”€ ðŸ¤– types.gen.ts      â† è‡ªåŠ¨ç”Ÿæˆï¼ˆç±»åž‹å®šä¹‰ï¼‰
â”œâ”€â”€ ðŸ¤– sdk.gen.ts        â† è‡ªåŠ¨ç”Ÿæˆï¼ˆAPI å‡½æ•°ï¼‰
â”œâ”€â”€ ðŸ¤– client.gen.ts     â† è‡ªåŠ¨ç”Ÿæˆï¼ˆå®¢æˆ·ç«¯å®žä¾‹ï¼‰
â”œâ”€â”€ âœï¸  config.ts         â† ã€ä½ æ‰‹åŠ¨åˆ›å»ºã€‘é…ç½®æ–‡ä»¶
â”œâ”€â”€ ðŸ¤– client/           â† è‡ªåŠ¨ç”Ÿæˆï¼ˆå®¢æˆ·ç«¯æ ¸å¿ƒï¼‰
â””â”€â”€ ðŸ¤– core/             â† è‡ªåŠ¨ç”Ÿæˆï¼ˆå·¥å…·å‡½æ•°ï¼‰

ðŸ¤– = è‡ªåŠ¨ç”Ÿæˆï¼Œä¸è¦ä¿®æ”¹
âœï¸  = æ‰‹åŠ¨åˆ›å»ºï¼Œè‡ªç”±ä¿®æ”¹
```

### èŒè´£åˆ’åˆ†

| æ–‡ä»¶        | è´Ÿè´£ä»€ä¹ˆ                 | è°æ¥å†™          |
| ----------- | ------------------------ | --------------- |
| `*.gen.ts`  | "æ€Žä¹ˆå‘è¯·æ±‚"             | ðŸ¤– å·¥å…·è‡ªåŠ¨ç”Ÿæˆ |
| `config.ts` | "å‘åˆ°å“ªé‡Œ"ã€"å¸¦ä»€ä¹ˆå‡­è¯" | âœï¸ ä½ æ¥å†™       |

### æ¯”å–»

> ðŸš— **è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ** = ä¸€è¾†è½¦ï¼ˆæœ‰å¼•æ“Žã€æ–¹å‘ç›˜ã€è½®å­ï¼‰
>
> â›½ **config.ts** = åŠ æ²¹ + è®¾ç½®å¯¼èˆªç›®çš„åœ° + é…ç½®è¡Œè½¦è®°å½•ä»ª
>
> è½¦é€ å¥½äº†ä¸èƒ½å¼€ï¼Œä½ å¾—åŠ æ²¹ã€è®¾ç›®çš„åœ°æ‰èƒ½ä¸Šè·¯ï¼

---

## 2. åœ¨ç”Ÿæˆå‰è¿˜æ˜¯ç”ŸæˆåŽç¼–å†™ï¼Ÿ

### ç­”æ¡ˆï¼š**ç”ŸæˆåŽç¼–å†™**ï¼ˆä½†å®žé™…ä¸Šæ— æ‰€è°“ï¼‰

#### æŽ¨èé¡ºåº

```
1. è¿è¡Œ npm run api:generate     â† å…ˆç”Ÿæˆä»£ç 
2. åˆ›å»º src/api/config.ts        â† å†å†™é…ç½®
3. åœ¨ main.tsx ä¸­å¯¼å…¥ config.ts  â† åˆå§‹åŒ–é…ç½®
4. ç»„ä»¶ä¸­ä½¿ç”¨ API å‡½æ•°           â† å¼€å§‹ä½¿ç”¨
```

#### ä¸ºä»€ä¹ˆæŽ¨è"ç”ŸæˆåŽ"ï¼Ÿ

| åŽŸå›                  | è¯´æ˜Ž                                               |
| -------------------- | -------------------------------------------------- |
| **ä¾èµ–ç”Ÿæˆçš„ä»£ç **   | `config.ts` éœ€è¦å¯¼å…¥ `client.gen.ts` ä¸­çš„ `client` |
| **çŸ¥é“æœ‰ä»€ä¹ˆå¯é…ç½®** | çœ‹äº†ç”Ÿæˆçš„ä»£ç æ‰çŸ¥é“ client æœ‰å“ªäº›æ–¹æ³•             |
| **é¿å…æŠ¥é”™**         | å¦‚æžœå…ˆå†™ config.tsï¼Œå¯¼å…¥çš„ client è¿˜ä¸å­˜åœ¨ï¼Œä¼šæŠ¥é”™ |

#### ä¸ºä»€ä¹ˆè¯´"æ— æ‰€è°“"ï¼Ÿ

å¦‚æžœä½ **å·²ç»çŸ¥é“é…ç½®çš„å†™æ³•**ï¼Œä¹Ÿå¯ä»¥å…ˆå†™å¥½ `config.ts`ï¼Œç­‰ç”Ÿæˆä»£ç åŽè‡ªç„¶å°±èƒ½ç”¨äº†ã€‚åªè¦ä¿è¯ `npm run api:generate` è¿è¡Œè¿‡ï¼Œ`client.gen.ts` å­˜åœ¨å³å¯ã€‚

---

## 3. æ–‡ä»¶ç»„ç»‡ç»“æž„

### æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åº”ç”¨å¯åŠ¨æ—¶çš„åˆå§‹åŒ–æµç¨‹                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

main.tsx
   â”‚
   â”‚ import './api/config'  (åªå¯¼å…¥ä¸€æ¬¡)
   â”‚
   â–¼
config.ts
   â”‚
   â”‚ 1. å¯¼å…¥ client
   â”‚ 2. è®¾ç½® baseUrl
   â”‚ 3. æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨ï¼ˆè‡ªåŠ¨åŠ  Tokenï¼‰
   â”‚ 4. æ·»åŠ å“åº”æ‹¦æˆªå™¨ï¼ˆå¤„ç† 401ï¼‰
   â”‚
   â–¼
client (å·²é…ç½®å¥½ï¼Œå…¨å±€ç”Ÿæ•ˆ)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç»„ä»¶ä½¿ç”¨ API çš„æµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Component.tsx
   â”‚
   â”‚ import { loginUsersLoginPost } from '@/api'
   â”‚
   â–¼
sdk.gen.ts (API å‡½æ•°)
   â”‚
   â”‚ å†…éƒ¨ä½¿ç”¨ client
   â”‚
   â–¼
client (å·²è¢« config.ts é…ç½®å¥½)
   â”‚
   â”‚ è‡ªåŠ¨æ·»åŠ  baseUrl
   â”‚ è‡ªåŠ¨æ·»åŠ  Authorization header
   â”‚
   â–¼
å‘é€ HTTP è¯·æ±‚åˆ°åŽç«¯
```

### å…³é”®ç‚¹

1. **`config.ts` åªéœ€è¦è¢«å¯¼å…¥ä¸€æ¬¡**ï¼ˆåœ¨ `main.tsx` ä¸­ï¼‰
2. **ç»„ä»¶ä¸éœ€è¦å¯¼å…¥ `config.ts`**ï¼Œç›´æŽ¥å¯¼å…¥ SDK å‡½æ•°å³å¯
3. **é…ç½®æ˜¯å…¨å±€ç”Ÿæ•ˆçš„**ï¼Œæ‰€æœ‰ API è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨ä½¿ç”¨

---

## 4. å¦‚ä½•ç¼–å†™ config.ts

### æœ€å°é…ç½®ï¼ˆå¿…é¡»ï¼‰

```typescript
// src/api/config.ts

import { client } from "./client.gen";

// é…ç½® API åŸºç¡€åœ°å€ï¼ˆå¿…é¡»ï¼ï¼‰
client.setConfig({
  baseUrl: import.meta.env.VITE_API_URL || "http://localhost:8000",
});

export { client };
```

### æ ‡å‡†é…ç½®ï¼ˆæŽ¨èï¼‰

```typescript
// src/api/config.ts

import { client } from "./client.gen";

// ============================================================
// 1. åŸºç¡€é…ç½®
// ============================================================
client.setConfig({
  baseUrl: import.meta.env.VITE_API_URL || "http://localhost:8000",
});

// ============================================================
// 2. è¯·æ±‚æ‹¦æˆªå™¨ï¼šè‡ªåŠ¨æ·»åŠ  Token
// ============================================================
client.interceptors.request.use((request) => {
  const token = localStorage.getItem("access_token");
  if (token) {
    request.headers.set("Authorization", `Bearer ${token}`);
  }
  return request;
});

// ============================================================
// 3. å“åº”æ‹¦æˆªå™¨ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†
// ============================================================
client.interceptors.response.use((response) => {
  // å¤„ç† 401 æœªæŽˆæƒï¼ˆToken è¿‡æœŸæˆ–æ— æ•ˆï¼‰
  if (response.status === 401) {
    localStorage.removeItem("access_token");
    // é¿å…åœ¨ç™»å½•é¡µå¾ªçŽ¯è·³è½¬
    if (!window.location.pathname.includes("/login")) {
      window.location.href = "/login";
    }
  }
  return response;
});

export { client };
```

### å®Œæ•´é…ç½®ï¼ˆé«˜çº§ï¼‰

```typescript
// src/api/config.ts

import { client } from "./client.gen";

// ============================================================
// 1. åŸºç¡€é…ç½®
// ============================================================
client.setConfig({
  baseUrl: import.meta.env.VITE_API_URL || "http://localhost:8000",
});

// ============================================================
// 2. è¯·æ±‚æ‹¦æˆªå™¨
// ============================================================

// 2.1 è‡ªåŠ¨æ·»åŠ  Token
client.interceptors.request.use((request) => {
  const token = localStorage.getItem("access_token");
  if (token) {
    request.headers.set("Authorization", `Bearer ${token}`);
  }
  return request;
});

// 2.2 æ·»åŠ è¯·æ±‚ IDï¼ˆç”¨äºŽè¿½è¸ªå’Œè°ƒè¯•ï¼‰
client.interceptors.request.use((request) => {
  const requestId = crypto.randomUUID();
  request.headers.set("X-Request-ID", requestId);
  console.log(`[API] ${request.method} ${request.url} - ${requestId}`);
  return request;
});

// ============================================================
// 3. å“åº”æ‹¦æˆªå™¨
// ============================================================

// 3.1 ç»Ÿä¸€é”™è¯¯å¤„ç†
client.interceptors.response.use((response) => {
  // 401 æœªæŽˆæƒ
  if (response.status === 401) {
    localStorage.removeItem("access_token");
    if (!window.location.pathname.includes("/login")) {
      window.location.href = "/login";
    }
  }

  // 403 ç¦æ­¢è®¿é—®
  if (response.status === 403) {
    console.error("æ²¡æœ‰æƒé™è®¿é—®æ­¤èµ„æº");
    // å¯ä»¥è·³è½¬åˆ° 403 é¡µé¢æˆ–æ˜¾ç¤ºæç¤º
  }

  // 500 æœåŠ¡å™¨é”™è¯¯
  if (response.status >= 500) {
    console.error("æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åŽé‡è¯•");
    // å¯ä»¥æ˜¾ç¤ºå…¨å±€é”™è¯¯æç¤º
  }

  return response;
});

// 3.2 æ—¥å¿—è®°å½•
client.interceptors.response.use((response) => {
  console.log(`[API] Response: ${response.status} ${response.url}`);
  return response;
});

export { client };
```

---

## 5. é…ç½®é¡¹è¯¦è§£

### 5.1 `setConfig()` - åŸºç¡€è®¾ç½®

```typescript
client.setConfig({
  baseUrl: "http://localhost:8000", // API æœåŠ¡å™¨åœ°å€
});
```

| é€‰é¡¹      | ç±»åž‹     | è¯´æ˜Ž                 |
| --------- | -------- | -------------------- |
| `baseUrl` | `string` | API æœåŠ¡å™¨çš„åŸºç¡€ URL |

### 5.2 è¯·æ±‚æ‹¦æˆªå™¨ - å‘é€å‰å¤„ç†

```typescript
client.interceptors.request.use((request) => {
  // request æ˜¯ä¸€ä¸ª Request å¯¹è±¡
  // å¯ä»¥ä¿®æ”¹ headersã€body ç­‰

  // æ·»åŠ  header
  request.headers.set("X-Custom-Header", "value");

  // å¿…é¡»è¿”å›ž request
  return request;
});
```

**å¸¸è§ç”¨é€”ï¼š**

- âœ… è‡ªåŠ¨æ·»åŠ è®¤è¯ Token
- âœ… æ·»åŠ è¯·æ±‚è¿½è¸ª ID
- âœ… æ·»åŠ è¯­è¨€/æ—¶åŒº header
- âœ… æ—¥å¿—è®°å½•

### 5.3 å“åº”æ‹¦æˆªå™¨ - æ”¶åˆ°åŽå¤„ç†

```typescript
client.interceptors.response.use((response) => {
  // response æ˜¯ä¸€ä¸ª Response å¯¹è±¡
  // å¯ä»¥æ ¹æ® status åšå¤„ç†

  if (response.status === 401) {
    // å¤„ç†æœªæŽˆæƒ
  }

  // å¿…é¡»è¿”å›ž response
  return response;
});
```

**å¸¸è§ç”¨é€”ï¼š**

- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼ˆ401ã€403ã€500ï¼‰
- âœ… Token è¿‡æœŸè‡ªåŠ¨è·³è½¬ç™»å½•
- âœ… æ—¥å¿—è®°å½•
- âœ… æ˜¾ç¤ºå…¨å±€é”™è¯¯æç¤º

---

## 6. æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

| æ³¨æ„ç‚¹                          | è¯´æ˜Ž                                     |
| ------------------------------- | ---------------------------------------- |
| **åªå¯¼å…¥ä¸€æ¬¡**                  | åœ¨ `main.tsx` ä¸­å¯¼å…¥ï¼Œä¸è¦åœ¨å¤šä¸ªåœ°æ–¹å¯¼å…¥ |
| **ä¸è¦åœ¨ config.ts ä¸­è°ƒç”¨ API** | é…ç½®æ–‡ä»¶åªåšé…ç½®ï¼Œä¸è¦æœ‰ä¸šåŠ¡é€»è¾‘         |
| **ä½¿ç”¨çŽ¯å¢ƒå˜é‡**                | `baseUrl` åº”è¯¥ä»ŽçŽ¯å¢ƒå˜é‡è¯»å–ï¼Œä¸è¦ç¡¬ç¼–ç  |
| **é¿å…å¾ªçŽ¯è·³è½¬**                | å¤„ç† 401 æ—¶è¦æ£€æŸ¥æ˜¯å¦å·²åœ¨ç™»å½•é¡µ          |
| **æ‹¦æˆªå™¨é¡ºåº**                  | å¤šä¸ªæ‹¦æˆªå™¨æŒ‰æ·»åŠ é¡ºåºæ‰§è¡Œ                 |

### âœ… æ­£ç¡®åšæ³•

```typescript
// âœ… ä»ŽçŽ¯å¢ƒå˜é‡è¯»å–
client.setConfig({
  baseUrl: import.meta.env.VITE_API_URL || "http://localhost:8000",
});

// âœ… æ£€æŸ¥æ˜¯å¦å·²åœ¨ç™»å½•é¡µï¼Œé¿å…å¾ªçŽ¯
if (!window.location.pathname.includes("/login")) {
  window.location.href = "/login";
}
```

### âŒ é”™è¯¯åšæ³•

```typescript
// âŒ ç¡¬ç¼–ç  URL
client.setConfig({
  baseUrl: "http://localhost:8000", // ä¸Šçº¿åŽå°±å‡ºé—®é¢˜äº†ï¼
});

// âŒ æ²¡æœ‰é˜²æ­¢å¾ªçŽ¯è·³è½¬
if (response.status === 401) {
  window.location.href = "/login"; // å¦‚æžœå·²åœ¨ç™»å½•é¡µä¼šæ— é™å¾ªçŽ¯ï¼
}

// âŒ åœ¨ config.ts ä¸­è°ƒç”¨ API
import { getCurrentUserInfoUsersMeGet } from "./sdk.gen";
getCurrentUserInfoUsersMeGet(); // ä¸è¦è¿™æ ·åšï¼
```

### ðŸš¨ ç‰¹åˆ«æ³¨æ„ï¼šç™»å½•é¡µé¢å¯èƒ½å¡ä½çš„é—®é¢˜

å¦‚æžœä½ åœ¨ç™»å½•é¡µé¢è°ƒç”¨äº†éœ€è¦è®¤è¯çš„ APIï¼ˆå¦‚ `getMe()`ï¼‰ï¼Œè€Œç”¨æˆ·æ­¤æ—¶æ²¡æœ‰æœ‰æ•ˆçš„ Tokenï¼Œä¼šå‘ç”Ÿä»¥ä¸‹å¾ªçŽ¯ï¼š

1.  ç”¨æˆ·è®¿é—®ç™»å½•é¡µ `/login`
2.  ç™»å½•é¡µç»„ä»¶è°ƒç”¨ `getMe()` å°è¯•æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
3.  åŽç«¯è¿”å›ž 401ï¼ˆå› ä¸ºæ²¡æœ‰ Tokenï¼‰
4.  å“åº”æ‹¦æˆªå™¨æ£€æµ‹åˆ° 401ï¼Œè·³è½¬åˆ° `/login`
5.  å›žåˆ°æ­¥éª¤ 2... **æ— é™å¾ªçŽ¯ï¼**

**è§£å†³æ–¹æ¡ˆ**ï¼š

```typescript
// âœ… æ–¹æ¡ˆ 1ï¼šåœ¨æ‹¦æˆªå™¨ä¸­æŽ’é™¤ç™»å½•ç›¸å…³é¡µé¢
client.interceptors.response.use((response) => {
  if (response.status === 401) {
    localStorage.removeItem("access_token");
    const path = window.location.pathname;
    // æŽ’é™¤ä¸éœ€è¦è·³è½¬çš„é¡µé¢
    if (
      !path.includes("/login") &&
      !path.includes("/register") &&
      !path.includes("/forgot-password")
    ) {
      window.location.href = "/login";
    }
  }
  return response;
});

// âœ… æ–¹æ¡ˆ 2ï¼šåœ¨ç™»å½•é¡µé¢ä¸è°ƒç”¨éœ€è¦è®¤è¯çš„ API
// Login.tsx
function Login() {
  // âŒ ä¸è¦è¿™æ ·åš
  // const { data } = await getMe();

  // âœ… ç™»å½•é¡µåªéœ€è¦å¤„ç†ç™»å½•é€»è¾‘
  const handleLogin = async () => {
    await login({ body: { username, password } });
  };
}
```

---

## 7. å¸¸è§é—®é¢˜

### Q1: config.ts ä¼šè¢«é‡æ–°ç”Ÿæˆè¦†ç›–å—ï¼Ÿ

**ä¼šè¢«åˆ é™¤ï¼** è™½ç„¶ `config.ts` æ˜¯æ‰‹åŠ¨åˆ›å»ºçš„ï¼Œä½† `@hey-api/openapi-ts` ç”Ÿæˆå·¥å…·åœ¨è¿è¡Œæ—¶ä¼š**æ¸…ç©ºæ•´ä¸ª output ç›®å½•**ï¼ˆ`src/api/`ï¼‰ï¼Œç„¶åŽé‡æ–°ç”Ÿæˆæ‰€æœ‰æ–‡ä»¶ã€‚æ‰€ä»¥ `config.ts` è™½ç„¶ä¸å¸¦ `.gen.ts` åŽç¼€ï¼Œä½†ä¹Ÿä¼šè¢«åˆ é™¤ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•çš„ä¸€é”®è„šæœ¬ `./scripts/generate-api.sh`ï¼Œå®ƒä¼šåœ¨ç”ŸæˆåŽè‡ªåŠ¨ä»Žæ¨¡æ¿æ¢å¤ `config.ts`ã€‚

æ¨¡æ¿æ–‡ä»¶ä½ç½®ï¼š`frontend/templates/api-config.ts`

### Q2: å¦‚æžœä¸åˆ›å»º config.ts ä¼šæ€Žæ ·ï¼Ÿ

API è°ƒç”¨ä¼šå¤±è´¥ï¼Œå› ä¸ºï¼š

- æ²¡æœ‰é…ç½® `baseUrl`ï¼Œè¯·æ±‚ä¼šå‘åˆ°é”™è¯¯çš„åœ°å€
- æ²¡æœ‰é…ç½® Token æ‹¦æˆªå™¨ï¼Œéœ€è¦è®¤è¯çš„æŽ¥å£ä¼šè¿”å›ž 401

### Q3: å¯ä»¥æœ‰å¤šä¸ªé…ç½®æ–‡ä»¶å—ï¼Ÿ

å¯ä»¥ï¼Œä½†ä¸æŽ¨èã€‚å¦‚æžœä½ æœ‰ç‰¹æ®Šéœ€æ±‚ï¼ˆæ¯”å¦‚å¤šä¸ªåŽç«¯æœåŠ¡ï¼‰ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ª client å®žä¾‹ï¼Œä½†è¿™è¶…å‡ºäº†æœ¬æ–‡æ¡£çš„èŒƒå›´ã€‚

### Q4: æ‹¦æˆªå™¨å¯ä»¥å¼‚æ­¥å—ï¼Ÿ

å¯ä»¥ï¼æ‹¦æˆªå™¨æ”¯æŒè¿”å›ž Promiseï¼š

```typescript
client.interceptors.request.use(async (request) => {
  // å¯ä»¥åšå¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚ä»Žå­˜å‚¨ä¸­è¯»å– token
  const token = await AsyncStorage.getItem("token");
  if (token) {
    request.headers.set("Authorization", `Bearer ${token}`);
  }
  return request;
});
```

---

## å¿«é€Ÿå‚è€ƒ

### å¿…é¡»åšçš„äº‹

1. âœ… åˆ›å»º `src/api/config.ts`
2. âœ… é…ç½® `baseUrl`
3. âœ… åœ¨ `main.tsx` ä¸­ `import './api/config'`

### æŽ¨èåšçš„äº‹

1. âœ… æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨ï¼ˆè‡ªåŠ¨åŠ  Tokenï¼‰
2. âœ… æ·»åŠ å“åº”æ‹¦æˆªå™¨ï¼ˆå¤„ç† 401ï¼‰
3. âœ… ä½¿ç”¨çŽ¯å¢ƒå˜é‡é…ç½® baseUrl

### æ–‡ä»¶æ¨¡æ¿

```typescript
// src/api/config.ts
import { client } from "./client.gen";

client.setConfig({
  baseUrl: import.meta.env.VITE_API_URL || "http://localhost:8000",
});

client.interceptors.request.use((request) => {
  const token = localStorage.getItem("access_token");
  if (token) {
    request.headers.set("Authorization", `Bearer ${token}`);
  }
  return request;
});

client.interceptors.response.use((response) => {
  if (response.status === 401) {
    localStorage.removeItem("access_token");
    if (!window.location.pathname.includes("/login")) {
      window.location.href = "/login";
    }
  }
  return response;
});

export { client };
```

---

_æ–‡æ¡£åˆ›å»ºæ—¶é—´: 2025-12-04_
