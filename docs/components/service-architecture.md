# Docker Compose æœåŠ¡æ¶æ„è¯¦è§£

æœ¬æ–‡æ¡£è¯¦ç»†è§£æå…¨æ ˆé¡¹ç›®ä¸­äº”ä¸ªæ ¸å¿ƒæœåŠ¡çš„ä½œç”¨åŠå…¶ç›¸äº’åä½œæ–¹å¼ã€‚

---

## ç›®å½•

1. [æ•´ä½“æ¶æ„å›¾](#æ•´ä½“æ¶æ„å›¾)
2. [æœåŠ¡å¯åŠ¨æµç¨‹](#æœåŠ¡å¯åŠ¨æµç¨‹)
3. [å„æœåŠ¡è¯¦è§£](#å„æœåŠ¡è¯¦è§£)
   - [db (æ•°æ®åº“)](#1-db-æ•°æ®åº“)
   - [prestart (é¢„å¯åŠ¨/è¿ç§»)](#2-prestart-é¢„å¯åŠ¨è¿ç§»)
   - [backend (åç«¯ API)](#3-backend-åç«¯-api)
   - [frontend (å‰ç«¯åº”ç”¨)](#4-frontend-å‰ç«¯åº”ç”¨)
   - [adminer (æ•°æ®åº“ç®¡ç†)](#5-adminer-æ•°æ®åº“ç®¡ç†)
4. [æœåŠ¡é—´é€šä¿¡](#æœåŠ¡é—´é€šä¿¡)
5. [ç”Ÿå‘½å‘¨æœŸç®¡ç†](#ç”Ÿå‘½å‘¨æœŸç®¡ç†)

---

## æ•´ä½“æ¶æ„å›¾

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚      ç”¨æˆ·æµè§ˆå™¨      â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                     â”‚                     â”‚
                         â–¼                     â–¼                     â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   Frontend    â”‚     â”‚    Backend    â”‚     â”‚    Adminer    â”‚
                 â”‚   å‰ç«¯åº”ç”¨     â”‚     â”‚   åç«¯ API    â”‚     â”‚  æ•°æ®åº“ç®¡ç†    â”‚
                 â”‚               â”‚     â”‚               â”‚     â”‚               â”‚
                 â”‚  dashboard.   â”‚     â”‚    api.       â”‚     â”‚   adminer.    â”‚
                 â”‚  domain.com   â”‚     â”‚  domain.com   â”‚     â”‚  domain.com   â”‚
                 â”‚               â”‚     â”‚               â”‚     â”‚               â”‚
                 â”‚   (React/     â”‚     â”‚   (FastAPI)   â”‚     â”‚   (PHP)       â”‚
                 â”‚    Vue/Next)  â”‚     â”‚               â”‚     â”‚               â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                     â”‚                     â”‚
                         â”‚                     â”‚                     â”‚
                         â”‚    HTTP API è°ƒç”¨    â”‚                     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
                                               â”‚                     â”‚
                                               â–¼                     â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
                                    â”‚     Prestart      â”‚            â”‚
                                    â”‚    é¢„å¯åŠ¨æœåŠ¡      â”‚            â”‚
                                    â”‚                   â”‚            â”‚
                                    â”‚  â€¢ æ•°æ®åº“è¿ç§»      â”‚            â”‚
                                    â”‚  â€¢ åˆå§‹åŒ–æ•°æ®      â”‚            â”‚
                                    â”‚  â€¢ ç¯å¢ƒæ£€æŸ¥        â”‚            â”‚
                                    â”‚                   â”‚            â”‚
                                    â”‚  (ä¸€æ¬¡æ€§ä»»åŠ¡)      â”‚            â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                                              â”‚                      â”‚
                                              â”‚  SQL è¿æ¥            â”‚
                                              â–¼                      â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚              db (PostgreSQL)        â”‚
                                    â”‚                æ•°æ®åº“                â”‚
                                    â”‚                                     â”‚
                                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
                                    â”‚  â”‚ users   â”‚  â”‚ posts   â”‚  ...     â”‚
                                    â”‚  â”‚   è¡¨    â”‚  â”‚   è¡¨    â”‚          â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                                    â”‚                                     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚    Volume     â”‚
                                              â”‚   æ•°æ®æŒä¹…åŒ–   â”‚
                                              â”‚               â”‚
                                              â”‚ postgres_data â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æœåŠ¡å¯åŠ¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              å¯åŠ¨æ—¶é—´çº¿                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  t=0s        t=30s              t=35s                t=40s                   â”‚
â”‚   â”‚           â”‚                  â”‚                    â”‚                      â”‚
â”‚   â–¼           â–¼                  â–¼                    â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”      â”Œâ”€â”€â”€â”              â”Œâ”€â”€â”€â”                â”Œâ”€â”€â”€â”     â”Œâ”€â”€â”€â”         â”‚
â”‚  â”‚db â”‚ â”€â”€â–¶  â”‚db â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚preâ”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚apiâ”‚     â”‚webâ”‚         â”‚
â”‚  â”‚å¯åŠ¨â”‚      â”‚å¥åº·â”‚              â”‚æ‰§è¡Œâ”‚                â”‚å¯åŠ¨â”‚     â”‚å¯åŠ¨â”‚         â”‚
â”‚  â””â”€â”€â”€â”˜      â””â”€â”€â”€â”˜              â””â”€â”€â”€â”˜                â””â”€â”€â”€â”˜     â””â”€â”€â”€â”˜         â”‚
â”‚                                                        â”‚         â”‚           â”‚
â”‚   å¯åŠ¨        å¥åº·æ£€æŸ¥            è¿ç§»å®Œæˆ               åç«¯å°±ç»ª   å‰ç«¯å°±ç»ª     â”‚
â”‚  PostgreSQL   é€šè¿‡               é€€å‡ºç =0                                     â”‚
â”‚                                                                              â”‚
â”‚  â—€â”€â”€â”€â”€â”€â”€â”€ åˆå§‹åŒ–é˜¶æ®µ â”€â”€â”€â”€â”€â”€â–¶ â—€â”€ è¿ç§»é˜¶æ®µ â”€â–¶ â—€â”€â”€â”€â”€â”€ æœåŠ¡è¿è¡Œé˜¶æ®µ â”€â”€â”€â”€â”€â–¶        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    adminer      â”‚
                              â”‚  (éšæ—¶å¯è®¿é—®)    â”‚
                              â”‚  åªä¾èµ– db å¯åŠ¨  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–å…³ç³»é“¾

```yaml
db                    # ç¬¬ä¸€ä¸ªå¯åŠ¨ï¼Œæ— ä¾èµ–
  â†“
  condition: service_healthy   # ç­‰å¾…å¥åº·æ£€æŸ¥é€šè¿‡
  â†“
prestart              # æ‰§è¡Œæ•°æ®åº“è¿ç§»
  â†“
  condition: service_completed_successfully  # ç­‰å¾…æ‰§è¡Œå®Œæˆä¸”æˆåŠŸ
  â†“
backend               # åç«¯ API å¯åŠ¨
  â†“
frontend              # å‰ç«¯åº”ç”¨å¯åŠ¨ï¼ˆå¯é€‰ä¾èµ–åç«¯ï¼‰

adminer               # åªä¾èµ– dbï¼Œç‹¬ç«‹è¿è¡Œ
```

---

## å„æœåŠ¡è¯¦è§£

### 1. db (æ•°æ®åº“)

**è§’è‰²**ï¼šæ•°æ®å­˜å‚¨çš„æ ¸å¿ƒï¼Œæ‰€æœ‰ä¸šåŠ¡æ•°æ®çš„"å®¶"

```yaml
db:
  image: postgres:17
  restart: always
  healthcheck:
    test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
    interval: 10s
    retries: 5
    start_period: 30s
    timeout: 10s
  volumes:
    - app-db-data:/var/lib/postgresql/data/pgdata
  environment:
    - POSTGRES_PASSWORD=${POSTGRES_PASSWORD?Variable not set}
    - POSTGRES_USER=${POSTGRES_USER?Variable not set}
    - POSTGRES_DB=${POSTGRES_DB?Variable not set}
```

#### æ ¸å¿ƒèŒè´£

| èŒè´£ | è¯´æ˜ |
|------|------|
| æ•°æ®å­˜å‚¨ | ä¿å­˜ç”¨æˆ·ã€æ–‡ç« ã€è¯„è®ºç­‰æ‰€æœ‰ä¸šåŠ¡æ•°æ® |
| æ•°æ®æŒä¹…åŒ– | é€šè¿‡ Volume ç¡®ä¿å®¹å™¨é‡å¯åæ•°æ®ä¸ä¸¢å¤± |
| å¥åº·æ£€æŸ¥ | å‘Šè¯‰å…¶ä»–æœåŠ¡"æˆ‘å‡†å¤‡å¥½äº†" |
| è¿æ¥ç®¡ç† | å¤„ç†æ¥è‡ªåç«¯å’Œ Adminer çš„æ•°æ®åº“è¿æ¥ |

#### å¥åº·æ£€æŸ¥çš„é‡è¦æ€§

```
æ²¡æœ‰å¥åº·æ£€æŸ¥æ—¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ db  â”‚ â”€â”€â–¶ â”‚ backend â”‚ â”€â”€â–¶ â”‚  å´©æºƒï¼  â”‚
â”‚å¯åŠ¨ä¸­â”‚     â”‚å°è¯•è¿æ¥  â”‚     â”‚è¿æ¥å¤±è´¥  â”‚
â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   æ•°æ®åº“è¿˜æ²¡å‡†å¤‡å¥½ï¼Œåç«¯å°±å°è¯•è¿æ¥

æœ‰å¥åº·æ£€æŸ¥æ—¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ db  â”‚ â”€â”€â–¶ â”‚ db  â”‚ â”€â”€â–¶ â”‚ backend â”‚ â”€â”€â–¶ â”‚  æˆåŠŸï¼  â”‚
â”‚å¯åŠ¨ä¸­â”‚     â”‚ å°±ç»ª â”‚     â”‚  è¿æ¥   â”‚     â”‚ æ­£å¸¸è¿è¡Œ â”‚
â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ç­‰å¾…æ•°æ®åº“å®Œå…¨å°±ç»ªåï¼Œåç«¯æ‰å¯åŠ¨
```

#### ä¸ºä»€ä¹ˆæ˜¯"åœ°åŸº"ï¼Ÿ

```
                    å¦‚æœ db å´©æºƒ...
                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ backend â”‚      â”‚ adminer â”‚      â”‚prestart â”‚
    â”‚  æ— æ³•   â”‚      â”‚  æ— æ³•   â”‚      â”‚  æ— æ³•   â”‚
    â”‚ è¯»å†™æ•°æ® â”‚      â”‚ ç®¡ç†DB  â”‚      â”‚  è¿ç§»   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚frontend â”‚
    â”‚ APIè°ƒç”¨ â”‚
    â”‚ å…¨éƒ¨å¤±è´¥ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“è®ºï¼šdb æ˜¯æ•´ä¸ªç³»ç»Ÿçš„åŸºç¡€ï¼Œå¿…é¡»æœ€å…ˆå¯åŠ¨ä¸”ä¿æŒç¨³å®š
```

---

### 2. prestart (é¢„å¯åŠ¨/è¿ç§»)

**è§’è‰²**ï¼šæ•°æ®åº“çš„"è£…ä¿®å·¥"ï¼Œåœ¨æ­£å¼è¥ä¸šå‰å‡†å¤‡å¥½ä¸€åˆ‡

```yaml
prestart:
  image: '${DOCKER_IMAGE_BACKEND}:${TAG-latest}'
  build:
    context: ./backend
  depends_on:
    db:
      condition: service_healthy
      restart: true
  command: bash scripts/prestart.sh
  environment:
    - POSTGRES_SERVER=db
    - POSTGRES_USER=${POSTGRES_USER?Variable not set}
    # ... å…¶ä»–ç¯å¢ƒå˜é‡
```

#### æ ¸å¿ƒèŒè´£

| èŒè´£ | è¯´æ˜ |
|------|------|
| æ•°æ®åº“è¿ç§» | æ‰§è¡Œ Alembic è¿ç§»ï¼Œåˆ›å»º/æ›´æ–°è¡¨ç»“æ„ |
| åˆå§‹åŒ–æ•°æ® | åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·ã€é»˜è®¤é…ç½®ç­‰ |
| ç¯å¢ƒæ£€æŸ¥ | éªŒè¯æ•°æ®åº“è¿æ¥ã€é…ç½®æ˜¯å¦æ­£ç¡® |
| ä¸€æ¬¡æ€§ä»»åŠ¡ | æ‰§è¡Œå®Œå°±é€€å‡ºï¼Œä¸æ˜¯æŒç»­è¿è¡Œçš„æœåŠ¡ |

#### å…¸å‹çš„ prestart.sh è„šæœ¬

```bash
#!/bin/bash
set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "ğŸ” æ£€æŸ¥æ•°æ®åº“è¿æ¥..."
python -c "
from sqlalchemy import create_engine
import os
engine = create_engine(os.getenv('DATABASE_URL'))
engine.connect()
print('âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ')
"

echo "ğŸ”„ æ‰§è¡Œæ•°æ®åº“è¿ç§»..."
alembic upgrade head
echo "âœ… è¿ç§»å®Œæˆ"

echo "ğŸ‘¤ åˆ›å»ºåˆå§‹ç”¨æˆ·..."
python -c "
from app.initial_data import init
init()
print('âœ… åˆå§‹åŒ–å®Œæˆ')
"

echo "ğŸ‰ é¢„å¯åŠ¨ä»»åŠ¡å…¨éƒ¨å®Œæˆï¼"
```

#### ä¸ºä»€ä¹ˆéœ€è¦å•ç‹¬çš„ prestart æœåŠ¡ï¼Ÿ

```
æ–¹æ¡ˆ Aï¼šåœ¨ backend å¯åŠ¨æ—¶æ‰§è¡Œè¿ç§»
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              backend å®¹å™¨                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  è¿ç§»    â”‚ â”€â–¶ â”‚ APIæœåŠ¡  â”‚              â”‚
â”‚  â”‚ (é˜»å¡)   â”‚    â”‚          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                             â”‚
â”‚  é—®é¢˜ï¼š                                      â”‚
â”‚  â€¢ è¿ç§»å¤±è´¥ä¼šå¯¼è‡´æ•´ä¸ªå®¹å™¨é‡å¯               â”‚
â”‚  â€¢ å¤šå‰¯æœ¬æ—¶ä¼šé‡å¤æ‰§è¡Œè¿ç§»                   â”‚
â”‚  â€¢ å¥åº·æ£€æŸ¥æœŸé—´åœ¨æ‰§è¡Œè¿ç§»ï¼Œæ£€æŸ¥ä¼šå¤±è´¥        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–¹æ¡ˆ Bï¼šç‹¬ç«‹çš„ prestart æœåŠ¡ âœ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   prestart   â”‚  â”€â”€â”€â”€â–¶  â”‚   backend    â”‚
â”‚              â”‚ æˆåŠŸå   â”‚              â”‚
â”‚  â€¢ æ‰§è¡Œè¿ç§»  â”‚         â”‚  â€¢ åªè¿è¡ŒAPI â”‚
â”‚  â€¢ åˆå§‹åŒ–    â”‚         â”‚  â€¢ å¯å¤šå‰¯æœ¬  â”‚
â”‚  â€¢ é€€å‡º      â”‚         â”‚  â€¢ æ— é˜»å¡    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼š
â€¢ èŒè´£åˆ†ç¦»ï¼Œæ›´æ¸…æ™°
â€¢ è¿ç§»å¤±è´¥ä¸å½±å“å·²è¿è¡Œçš„åç«¯
â€¢ åç«¯å¯ä»¥æ°´å¹³æ‰©å±•å¤šä¸ªå‰¯æœ¬
```

#### service_completed_successfully çš„å«ä¹‰

```yaml
depends_on:
  prestart:
    condition: service_completed_successfully
```

```
prestart æ‰§è¡Œå®Œæ¯•
      â”‚
      â”œâ”€â”€â”€ é€€å‡ºç  = 0 â”€â”€â–¶ backend å¼€å§‹å¯åŠ¨ âœ…
      â”‚
      â””â”€â”€â”€ é€€å‡ºç  â‰  0 â”€â”€â–¶ backend ä¸å¯åŠ¨ï¼ŒæŠ¥é”™ âŒ
                          (è¿ç§»å¤±è´¥ï¼Œéœ€è¦äººå·¥å¤„ç†)
```

---

### 3. backend (åç«¯ API)

**è§’è‰²**ï¼šä¸šåŠ¡é€»è¾‘çš„"å¤§è„‘"ï¼Œå¤„ç†æ‰€æœ‰æ•°æ®æ“ä½œ

```yaml
backend:
  image: '${DOCKER_IMAGE_BACKEND}:${TAG-latest}'
  restart: always
  depends_on:
    db:
      condition: service_healthy
      restart: true
    prestart:
      condition: service_completed_successfully
  environment:
    - POSTGRES_SERVER=db
    - SECRET_KEY=${SECRET_KEY?Variable not set}
    # ... å…¶ä»–ç¯å¢ƒå˜é‡
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost:8000/api/v1/utils/health-check/"]
    interval: 10s
    timeout: 5s
    retries: 5
  labels:
    - traefik.http.routers.${STACK_NAME}-backend-https.rule=Host(`api.${DOMAIN}`)
```

#### æ ¸å¿ƒèŒè´£

| èŒè´£ | è¯´æ˜ |
|------|------|
| API æ¥å£ | æä¾› RESTful API ä¾›å‰ç«¯è°ƒç”¨ |
| ä¸šåŠ¡é€»è¾‘ | ç”¨æˆ·è®¤è¯ã€æ–‡ç« ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ |
| æ•°æ®éªŒè¯ | éªŒè¯è¯·æ±‚æ•°æ®çš„åˆæ³•æ€§ |
| æ•°æ®åº“æ“ä½œ | å¯¹ PostgreSQL è¿›è¡Œ CRUD æ“ä½œ |
| å®‰å…¨æ§åˆ¶ | JWT è®¤è¯ã€å¯†ç åŠ å¯†ã€CORS ç­‰ |

#### åç«¯çš„ä½ç½®å’Œä½œç”¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Backend çš„èŒè´£                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   Frontend                    Backend                   DB   â”‚
â”‚      â”‚                           â”‚                       â”‚   â”‚
â”‚      â”‚  POST /api/users         â”‚                       â”‚   â”‚
â”‚      â”‚  {name: "å¼ ä¸‰"}          â”‚                       â”‚   â”‚
â”‚      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚                       â”‚   â”‚
â”‚      â”‚                          â”‚  éªŒè¯æ•°æ®              â”‚   â”‚
â”‚      â”‚                          â”‚  æ£€æŸ¥æƒé™              â”‚   â”‚
â”‚      â”‚                          â”‚  åŠ å¯†å¯†ç               â”‚   â”‚
â”‚      â”‚                          â”‚                       â”‚   â”‚
â”‚      â”‚                          â”‚  INSERT INTO users    â”‚   â”‚
â”‚      â”‚                          â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   â”‚
â”‚      â”‚                          â”‚                       â”‚   â”‚
â”‚      â”‚                          â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚      â”‚                          â”‚  è¿”å›æ–°ç”¨æˆ· ID         â”‚   â”‚
â”‚      â”‚                          â”‚                       â”‚   â”‚
â”‚      â”‚  {"id": 1, "name": "å¼ ä¸‰"} â”‚                      â”‚   â”‚
â”‚      â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                       â”‚   â”‚
â”‚      â”‚                          â”‚                       â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å…¸å‹çš„ API ç«¯ç‚¹

```
GET    /api/v1/users           # è·å–ç”¨æˆ·åˆ—è¡¨
POST   /api/v1/users           # åˆ›å»ºç”¨æˆ·
GET    /api/v1/users/{id}      # è·å–å•ä¸ªç”¨æˆ·
PUT    /api/v1/users/{id}      # æ›´æ–°ç”¨æˆ·
DELETE /api/v1/users/{id}      # åˆ é™¤ç”¨æˆ·

POST   /api/v1/auth/login      # ç”¨æˆ·ç™»å½•
POST   /api/v1/auth/register   # ç”¨æˆ·æ³¨å†Œ
GET    /api/v1/auth/me         # è·å–å½“å‰ç”¨æˆ·

GET    /api/v1/posts           # è·å–æ–‡ç« åˆ—è¡¨
POST   /api/v1/posts           # åˆ›å»ºæ–‡ç« 
...
```

---

### 4. frontend (å‰ç«¯åº”ç”¨)

**è§’è‰²**ï¼šç”¨æˆ·ç•Œé¢çš„"é—¨é¢"ï¼Œç”¨æˆ·ç›´æ¥äº¤äº’çš„éƒ¨åˆ†

```yaml
frontend:
  image: '${DOCKER_IMAGE_FRONTEND}:${TAG-latest}'
  restart: always
  build:
    context: ./frontend
    args:
      - VITE_API_URL=https://api.${DOMAIN}
      - NODE_ENV=production
  labels:
    - traefik.http.routers.${STACK_NAME}-frontend-https.rule=Host(`dashboard.${DOMAIN}`)
    - traefik.http.services.${STACK_NAME}-frontend.loadbalancer.server.port=80
```

#### æ ¸å¿ƒèŒè´£

| èŒè´£ | è¯´æ˜ |
|------|------|
| ç”¨æˆ·ç•Œé¢ | å±•ç¤ºé¡µé¢ã€è¡¨å•ã€æŒ‰é’®ç­‰ UI å…ƒç´  |
| ç”¨æˆ·äº¤äº’ | å“åº”ç‚¹å‡»ã€è¾“å…¥ç­‰ç”¨æˆ·æ“ä½œ |
| API è°ƒç”¨ | å‘åç«¯å‘é€ HTTP è¯·æ±‚ |
| çŠ¶æ€ç®¡ç† | ç®¡ç†ç™»å½•çŠ¶æ€ã€é¡µé¢æ•°æ®ç­‰ |
| è·¯ç”±æ§åˆ¶ | é¡µé¢å¯¼èˆªå’Œ URL ç®¡ç† |

#### å‰ç«¯ä¸åç«¯çš„äº¤äº’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç”¨æˆ·æ“ä½œæµç¨‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ ç”¨æˆ·æµè§ˆå™¨ â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚       â”‚ 1. è®¿é—® https://dashboard.domain.com                         â”‚
â”‚       â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ Frontend â”‚  â—€â”€â”€ è¿”å› HTML/CSS/JS                                  â”‚
â”‚  â”‚  (Nginx) â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚       â”‚ 2. æµè§ˆå™¨æ¸²æŸ“é¡µé¢                                             â”‚
â”‚       â”‚ 3. ç”¨æˆ·ç‚¹å‡»"ç™»å½•"æŒ‰é’®                                         â”‚
â”‚       â”‚ 4. å‰ç«¯ JS å‘é€è¯·æ±‚åˆ° https://api.domain.com/auth/login       â”‚
â”‚       â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ Backend  â”‚  â—€â”€â”€ éªŒè¯ç”¨æˆ·åå¯†ç ï¼Œè¿”å› JWT Token                      â”‚
â”‚  â”‚ (FastAPI)â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚       â”‚ 5. å‰ç«¯ä¿å­˜ Tokenï¼Œæ˜¾ç¤º"ç™»å½•æˆåŠŸ"                              â”‚
â”‚       â”‚ 6. ç”¨æˆ·ç‚¹å‡»"æˆ‘çš„æ–‡ç« "                                         â”‚
â”‚       â”‚ 7. å‰ç«¯å‘é€ GET /api/posts (å¸¦ä¸Š Token)                       â”‚
â”‚       â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚ Backend  â”‚ â”€â”€â”€â–¶ â”‚   DB   â”‚  â—€â”€â”€ æŸ¥è¯¢ç”¨æˆ·çš„æ–‡ç«                      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚       â”‚ 8. è¿”å›æ–‡ç« åˆ—è¡¨ JSON                                          â”‚
â”‚       â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ Frontend â”‚  â—€â”€â”€ æ¸²æŸ“æ–‡ç« åˆ—è¡¨                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ„å»ºæ—¶ vs è¿è¡Œæ—¶

```yaml
build:
  args:
    - VITE_API_URL=https://api.${DOMAIN}  # æ„å»ºæ—¶"çƒ˜ç„™"è¿›ä»£ç 
    - NODE_ENV=production
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯æ„å»ºè¿‡ç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æºä»£ç  (React/Vue)        æ„å»ºäº§ç‰© (é™æ€æ–‡ä»¶)                â”‚
â”‚                                                             â”‚
â”‚  src/                      dist/                            â”‚
â”‚  â”œâ”€â”€ App.vue          â”€â”€â–¶  â”œâ”€â”€ index.html                   â”‚
â”‚  â”œâ”€â”€ api.js                â”œâ”€â”€ assets/                      â”‚
â”‚  â”‚   fetch(VITE_API_URL)   â”‚   â”œâ”€â”€ app.js    â—€â”€â”€ APIåœ°å€    â”‚
â”‚  â””â”€â”€ ...                   â”‚   â””â”€â”€ app.css       è¢«å†™æ­»åœ¨   â”‚
â”‚                            â””â”€â”€ ...               JSæ–‡ä»¶ä¸­    â”‚
â”‚                                                             â”‚
â”‚  æ³¨æ„ï¼šå‰ç«¯æ„å»ºåæ˜¯é™æ€æ–‡ä»¶ï¼Œè¿è¡Œæ—¶æ— æ³•è¯»å–ç¯å¢ƒå˜é‡            â”‚
â”‚  æ‰€ä»¥ API åœ°å€å¿…é¡»åœ¨æ„å»ºæ—¶é€šè¿‡ build args ä¼ å…¥               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. adminer (æ•°æ®åº“ç®¡ç†)

**è§’è‰²**ï¼šæ•°æ®åº“çš„"ç®¡ç†åå°"ï¼Œæ–¹ä¾¿å¼€å‘è€…æŸ¥çœ‹å’Œæ“ä½œæ•°æ®

```yaml
adminer:
  image: adminer
  restart: always
  depends_on:
    - db
  environment:
    - ADMINER_DESIGN=pepa-linha-dark
  labels:
    - traefik.http.routers.${STACK_NAME}-adminer-https.rule=Host(`adminer.${DOMAIN}`)
    - traefik.http.services.${STACK_NAME}-adminer.loadbalancer.server.port=8080
```

#### æ ¸å¿ƒèŒè´£

| èŒè´£ | è¯´æ˜ |
|------|------|
| å¯è§†åŒ–ç®¡ç† | é€šè¿‡ Web ç•Œé¢ç®¡ç†æ•°æ®åº“ |
| SQL æ‰§è¡Œ | ç›´æ¥æ‰§è¡Œ SQL æŸ¥è¯¢ |
| æ•°æ®æµè§ˆ | æŸ¥çœ‹è¡¨ç»“æ„å’Œæ•°æ® |
| å¯¼å…¥å¯¼å‡º | å¤‡ä»½å’Œæ¢å¤æ•°æ® |
| è°ƒè¯•å·¥å…· | å¼€å‘æ—¶æ£€æŸ¥æ•°æ®çŠ¶æ€ |

#### Adminer ç•Œé¢é¢„è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Adminer - PostgreSQL                                     [ç™»å‡º]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  æœåŠ¡å™¨: db                æ•°æ®åº“: blog_fr                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ•°æ®åº“åˆ—è¡¨       â”‚  â”‚ è¡¨åˆ—è¡¨                                  â”‚   â”‚
â”‚  â”‚                 â”‚  â”‚                                        â”‚   â”‚
â”‚  â”‚ â— blog_fr       â”‚  â”‚  è¡¨å        â”‚ è¡Œæ•°  â”‚ å¤§å°  â”‚ æ“ä½œ    â”‚   â”‚
â”‚  â”‚   postgres      â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚                 â”‚  â”‚  users       â”‚ 10    â”‚ 16 KB â”‚ æŸ¥çœ‹   â”‚   â”‚
â”‚  â”‚                 â”‚  â”‚  posts       â”‚ 25    â”‚ 32 KB â”‚ æŸ¥çœ‹   â”‚   â”‚
â”‚  â”‚                 â”‚  â”‚  comments    â”‚ 100   â”‚ 48 KB â”‚ æŸ¥çœ‹   â”‚   â”‚
â”‚  â”‚                 â”‚  â”‚                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  [SQLå‘½ä»¤]  [å¯¼å…¥]  [å¯¼å‡º]  [åˆ›å»ºè¡¨]                                 â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Adminer vs å…¶ä»–å·¥å…·

| å·¥å…· | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| **Adminer** | è½»é‡ã€å•æ–‡ä»¶ã€æ”¯æŒå¤šç§æ•°æ®åº“ | åŠŸèƒ½ç›¸å¯¹ç®€å• |
| pgAdmin | åŠŸèƒ½å¼ºå¤§ã€PostgreSQL ä¸“ç”¨ | è¾ƒé‡ã€é…ç½®å¤æ‚ |
| DBeaver | è·¨å¹³å°æ¡Œé¢åº”ç”¨ã€åŠŸèƒ½å…¨é¢ | éœ€è¦æœ¬åœ°å®‰è£… |
| psql | å®˜æ–¹å‘½ä»¤è¡Œå·¥å…·ã€åŠŸèƒ½å®Œæ•´ | å­¦ä¹ æ›²çº¿è¾ƒé™¡ |

#### å®‰å…¨æ³¨æ„äº‹é¡¹

```
âš ï¸ ç”Ÿäº§ç¯å¢ƒå®‰å…¨å»ºè®®ï¼š

1. é™åˆ¶è®¿é—®
   â€¢ åªåœ¨å†…ç½‘å¼€æ”¾
   â€¢ ä½¿ç”¨ VPN è®¿é—®
   â€¢ æ·»åŠ  IP ç™½åå•

2. å¼ºè®¤è¯
   â€¢ ä½¿ç”¨å¼ºå¯†ç 
   â€¢ è€ƒè™‘æ·»åŠ  Basic Auth

3. è€ƒè™‘ç§»é™¤
   â€¢ ç”Ÿäº§ç¯å¢ƒå¯ä»¥ä¸éƒ¨ç½² Adminer
   â€¢ éœ€è¦æ—¶ä¸´æ—¶å¯åŠ¨
```

---

## æœåŠ¡é—´é€šä¿¡

### Docker ç½‘ç»œå†…éƒ¨é€šä¿¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Docker Compose å†…éƒ¨ç½‘ç»œ                          â”‚
â”‚                     (blog_fr_default)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   æœåŠ¡åå°±æ˜¯ä¸»æœºåï¼                                                  â”‚
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ backend  â”‚      â”‚ frontend â”‚      â”‚ adminer  â”‚                 â”‚
â”‚   â”‚          â”‚      â”‚          â”‚      â”‚          â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚        â”‚                                   â”‚                        â”‚
â”‚        â”‚  è¿æ¥åœ°å€ï¼šdb:5432                 â”‚                        â”‚
â”‚        â”‚  ä¸æ˜¯ localhostï¼                 â”‚                        â”‚
â”‚        â”‚  ä¸æ˜¯ IP åœ°å€ï¼                   â”‚                        â”‚
â”‚        â”‚                                   â”‚                        â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                         â”‚                                           â”‚
â”‚                         â–¼                                           â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚                   â”‚    db    â”‚                                      â”‚
â”‚                   â”‚ :5432    â”‚                                      â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¿æ¥å­—ç¬¦ä¸²ç¤ºä¾‹

```python
# åç«¯è¿æ¥æ•°æ®åº“
# âœ… æ­£ç¡®ï¼šä½¿ç”¨æœåŠ¡å
DATABASE_URL = "postgresql://postgres:password@db:5432/blog_fr"

# âŒ é”™è¯¯ï¼šä½¿ç”¨ localhostï¼ˆåœ¨å®¹å™¨å†… localhost æ˜¯å®¹å™¨è‡ªå·±ï¼‰
DATABASE_URL = "postgresql://postgres:password@localhost:5432/blog_fr"
```

### å¤–éƒ¨è®¿é—® vs å†…éƒ¨é€šä¿¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  å¤–éƒ¨ï¼ˆç”¨æˆ·æµè§ˆå™¨ï¼‰                  å†…éƒ¨ï¼ˆå®¹å™¨ä¹‹é—´ï¼‰                  â”‚
â”‚                                                                     â”‚
â”‚  https://api.domain.com            http://backend:8000              â”‚
â”‚  https://dashboard.domain.com      http://frontend:80               â”‚
â”‚  https://adminer.domain.com        http://adminer:8080              â”‚
â”‚                                    postgresql://db:5432              â”‚
â”‚        â”‚                                   â”‚                        â”‚
â”‚        â”‚ ç»è¿‡ Traefik                      â”‚ ç›´æ¥é€šä¿¡                â”‚
â”‚        â”‚ æœ‰ HTTPS                         â”‚ æ— åŠ å¯†ï¼ˆå†…ç½‘å®‰å…¨ï¼‰        â”‚
â”‚        â–¼                                   â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Traefik  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  å®¹å™¨    â”‚                   â”‚
â”‚  â”‚ åå‘ä»£ç†  â”‚                        â”‚         â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç”Ÿå‘½å‘¨æœŸç®¡ç†

### å¯åŠ¨é¡ºåºä¿è¯

```yaml
# å®Œæ•´çš„ä¾èµ–é“¾é…ç½®
services:
  db:
    # æ— ä¾èµ–ï¼Œç¬¬ä¸€ä¸ªå¯åŠ¨
    healthcheck:
      test: ["CMD-SHELL", "pg_isready"]

  prestart:
    depends_on:
      db:
        condition: service_healthy  # ç­‰ db å¥åº·
    # æ‰§è¡Œå®Œè¿ç§»åé€€å‡º

  backend:
    depends_on:
      db:
        condition: service_healthy
      prestart:
        condition: service_completed_successfully  # ç­‰ prestart æˆåŠŸé€€å‡º

  frontend:
    depends_on:
      backend:
        condition: service_healthy  # å¯é€‰ï¼šç­‰ backend å¥åº·

  adminer:
    depends_on:
      - db  # ç®€å•ä¾èµ–ï¼Œdb å¯åŠ¨å°±è¡Œ
```

### æ•…éšœæ¢å¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•…éšœåœºæ™¯ä¸æ¢å¤                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  åœºæ™¯ 1: db å´©æºƒ                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚  db å´©æºƒ â”€â”€â–¶ restart: always â”€â”€â–¶ db è‡ªåŠ¨é‡å¯ â”€â”€â–¶ å¥åº·æ£€æŸ¥é€šè¿‡        â”‚
â”‚                                       â”‚                             â”‚
â”‚                                       â–¼                             â”‚
â”‚                              å…¶ä»–æœåŠ¡è‡ªåŠ¨é‡è¿                         â”‚
â”‚                                                                     â”‚
â”‚  åœºæ™¯ 2: backend å´©æºƒ                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  backend å´©æºƒ â”€â”€â–¶ restart: always â”€â”€â–¶ backend è‡ªåŠ¨é‡å¯               â”‚
â”‚                                              â”‚                      â”‚
â”‚                                              â–¼                      â”‚
â”‚                                    æ£€æŸ¥ db æ˜¯å¦å¥åº·                  â”‚
â”‚                                    æ˜¯ â”€â”€â–¶ æ­£å¸¸å¯åŠ¨                   â”‚
â”‚                                    å¦ â”€â”€â–¶ ç­‰å¾… db                    â”‚
â”‚                                                                     â”‚
â”‚  åœºæ™¯ 3: prestart å¤±è´¥                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  prestart å¤±è´¥ â”€â”€â–¶ é€€å‡ºç  â‰  0 â”€â”€â–¶ backend ä¸ä¼šå¯åŠ¨                   â”‚
â”‚                                          â”‚                          â”‚
â”‚                                          â–¼                          â”‚
â”‚                               éœ€è¦äººå·¥ä¿®å¤åé‡è¯•ï¼š                    â”‚
â”‚                               docker compose up prestart             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¸¸ç”¨è¿ç»´å‘½ä»¤

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f backend

# é‡å¯å•ä¸ªæœåŠ¡
docker compose restart backend

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®ï¼ˆå±é™©ï¼ï¼‰
docker compose down -v

# åªè¿è¡Œé¢„å¯åŠ¨ï¼ˆæ‰‹åŠ¨æ‰§è¡Œè¿ç§»ï¼‰
docker compose up prestart

# æ‰©å±•åç«¯å‰¯æœ¬ï¼ˆéœ€è¦è´Ÿè½½å‡è¡¡ï¼‰
docker compose up -d --scale backend=3
```

---

## æ€»ç»“

### äº”å¤§æœåŠ¡çš„è§’è‰²æ¯”å–»

| æœåŠ¡ | è§’è‰²æ¯”å–» | æ ¸å¿ƒèŒè´£ |
|------|----------|----------|
| **db** | ä»“åº“ | å­˜å‚¨æ‰€æœ‰æ•°æ®ï¼Œæ˜¯ç³»ç»Ÿçš„æ ¹åŸº |
| **prestart** | è£…ä¿®å·¥ | å‡†å¤‡ç¯å¢ƒï¼Œæ‰§è¡Œè¿ç§»åç¦»å¼€ |
| **backend** | ç®¡å®¶ | å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä¸ä»“åº“æ²Ÿé€š |
| **frontend** | é—¨é¢ | ä¸å®¢æˆ·ï¼ˆç”¨æˆ·ï¼‰ç›´æ¥äº¤æµ |
| **adminer** | ç›‘æ§å®¤ | è®©ç®¡ç†å‘˜æŸ¥çœ‹ä»“åº“çŠ¶æ€ |

### æœåŠ¡é—´çš„æ•°æ®æµ

```
ç”¨æˆ· â”€â”€â–¶ Frontend â”€â”€â–¶ Backend â”€â”€â–¶ Database
              â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚
              â–¼           â–¼           â–¼
          æ˜¾ç¤ºç•Œé¢    å¤„ç†é€»è¾‘     å­˜å‚¨æ•°æ®
```

### è®°ä½è¿™ä¸ªå¯åŠ¨é¡ºåº

```
db (å¿…é¡»å…ˆå¥åº·) â”€â”€â–¶ prestart (å¿…é¡»æˆåŠŸå®Œæˆ) â”€â”€â–¶ backend â”€â”€â–¶ frontend
                                                   â”‚
                                              adminer (ç‹¬ç«‹)
```
