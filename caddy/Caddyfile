{
	# 全局配置
}

# ==================================================
# WWW 域名重定向到主域名 (解决 CORS 问题并统一权重)
# ==================================================
# 注意：需要在 .env 中设置 DOMAIN_NAME_WWW 变量才能启用
{$DOMAIN_NAME_WWW} {
	redir {scheme}://{$DOMAIN_NAME}{uri}
}

# ==================================================
# 前端应用 (主域名)
# ==================================================
{$DOMAIN_NAME} {
	# 启用压缩
	encode gzip

	# 转发到前端 Next.js 容器
	reverse_proxy frontend:3000

	# 处理 API 转发 (支持同域访问模式)
	handle /api/* {
		reverse_proxy backend:8000
	}
}

# ==================================================
# 后端 API (独立 API 子域名)
# ==================================================
{$API_DOMAIN_NAME} {
	reverse_proxy backend:8000
}

# ==================================================
# 配置说明
# ==================================================
# 1. 确保 .env 文件中已设置以下变量：
#    DOMAIN_NAME=yourdomain.com
#    DOMAIN_NAME_WWW=www.yourdomain.com
#    API_DOMAIN_NAME=api.yourdomain.com
# 2. Caddy 将自动处理 SSL 证书申请与续期。
# 3. 访问 www 域名将通过 301 重定向到主域名，彻底避免 CORS 跨域限制。
