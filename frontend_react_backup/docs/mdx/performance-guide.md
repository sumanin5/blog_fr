# 性能测试指南

## 测试主题切换性能

### 开发环境测试

1. **打开浏览器开发者工具**
   - 按 `F12`
   - 切换到 "Performance" 标签

2. **开始录制**
   - 点击录制按钮（圆圈图标）
   - 切换主题（点击主题按钮）
   - 停止录制

3. **查看结果**
   - 查看 "Rendering" 时间
   - 查看 "Painting" 时间
   - 通常在 500-800ms

### 生产环境测试

1. **构建生产版本**

   ```bash
   npm run build
   ```

2. **预览生产版本**

   ```bash
   npm run preview
   ```

3. **重复性能测试**
   - 使用相同的方法录制
   - 对比开发环境的时间
   - 应该快 50-60%（200-400ms）

### 优化建议

如果生产环境仍然慢：

1. **减少代码块数量**
   - 每个页面不要有太多代码块
   - 考虑分页或懒加载

2. **使用代码分割**
   - 大的代码块可以折叠
   - 只在需要时展开

3. **考虑单主题**
   - 如果用户很少切换主题
   - 可以只提供一个主题

## 验证系统主题跟随

### 测试步骤

1. **设置为系统主题**
   - 点击主题切换按钮
   - 选择 "System" 选项

2. **更改系统主题**
   - **Windows**: 设置 → 个性化 → 颜色 → 选择模式
   - **macOS**: 系统偏好设置 → 通用 → 外观
   - **Linux**: 取决于桌面环境

3. **验证自动切换**
   - 页面应该立即响应系统主题变化
   - 不需要刷新页面

### 如果不工作

检查以下内容：

1. **浏览器支持**

   ```javascript
   // 在浏览器控制台运行
   window.matchMedia("(prefers-color-scheme: dark)").matches;
   ```

   应该返回 `true` 或 `false`

2. **ThemeProvider 配置**
   - 确认 `defaultTheme="system"`
   - 确认 ThemeProvider 包裹了整个应用

3. **系统设置**
   - 确认系统确实设置了主题偏好
   - 某些系统可能不支持

## 代码块视觉效果

### 当前样式

```css
pre {
  background: var(--muted) / 0.8;
  border: 1px solid var(--border);
  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
  border-radius: 0.5rem;
  padding: 1rem;
}
```

### 如果还不够明显

可以增强样式：

```css
/* 更明显的边框 */
pre {
  border: 2px solid var(--border);
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
}

/* 或者添加背景色 */
pre {
  background: var(--muted);
  /* 移除透明度 */
}
```

## 常见问题

### Q: 为什么主题切换比其他网站慢？

A: 因为我们使用了 Shiki（构建时高亮），它提供最好的代码高亮效果，但切换主题需要重新渲染。其他网站可能使用：

- 运行时高亮（PrismJS）- 快但效果差
- 没有代码高亮
- 单主题

### Q: 生产环境真的会更快吗？

A: 是的！通常快 50-60%。原因：

- 代码压缩和优化
- 浏览器缓存
- 没有开发工具开销
- 更好的渲染性能

### Q: 可以完全消除延迟吗？

A: 不能完全消除，但可以优化到几乎察觉不到（<200ms）。如果需要即时切换，只能：

- 使用单主题
- 使用 CSS 变量方案（需要大量工作）
- 放弃 Shiki，使用运行时高亮

### Q: 系统主题跟随不工作怎么办？

A: 检查：

1. 浏览器是否支持 `prefers-color-scheme`
2. 系统是否正确设置了主题
3. ThemeProvider 是否正确配置
4. 浏览器控制台是否有错误

## 推荐配置

**当前配置是最佳实践**：

- ✅ Shiki 提供最好的代码高亮
- ✅ 支持双主题（亮/暗）
- ✅ 支持系统主题跟随
- ✅ 生产环境性能优秀
- ⚠️ 开发环境切换稍慢（可接受）

**不推荐改动**，除非：

- 用户强烈要求即时切换
- 愿意牺牲代码高亮质量
- 愿意投入大量时间实现 CSS 变量方案
